package com.standardchartered.u1603396.module.pdf_21_june.glue;

import java.io.*;

import javax.swing.JFileChooser;

import cucumber.api.java.en.Given;

public class ui_form {
    public static String Important_File_Path=System.getProperty("user.home") +"\\Documents\\Imp_Files";
    public static void  main(String [] args) throws Throwable{
        invoke();
    }
    @Given("^compare the pdf files$")

	public static void invoke() throws IOException,Throwable {
        pdf_compare_2_0 obj =new pdf_compare_2_0();
       /* pdf_compare_2_0.Create_Directory();
        pdf_compare_2_0.Create_Final_Result_Directory();
        pdf_compare_2_0.delete_files();*/
        delete_the_files_in_imp_path(System.getProperty("user.home") +"\\Documents\\Imp_Files\\Missing_File\\");

        String strSourcePath = null;
        String strDestinationPath=null;
        // TODO Auto-generated method stub
        JFileChooser chooser = new JFileChooser();
        chooser.setCurrentDirectory(new java.io.File("."));
        chooser.setDialogTitle("         SELECT THE SOURCE FILE PATH            ");
        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        chooser.setAcceptAllFileFilterUsed(false);

        if (chooser.showOpenDialog(null) == JFileChooser.APPROVE_OPTION) {
            System.out.println("getCurrentDirectory(): " + chooser.getCurrentDirectory());
            strSourcePath=chooser.getCurrentDirectory().toString();
            System.out.println("getSelectedFile() : " + chooser.getSelectedFile());
            strSourcePath=chooser.getSelectedFile().toString();
        } else {
            System.out.println("No Selection ");
        }

        JFileChooser chooser2 = new JFileChooser();
        chooser2.setCurrentDirectory(new java.io.File("."));
        chooser2.setDialogTitle("         SELECT THE DESTINATION FILE PATH            ");
        chooser2.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        chooser2.setAcceptAllFileFilterUsed(false);

        if (chooser2.showOpenDialog(null) == JFileChooser.APPROVE_OPTION) {
            System.out.println("getCurrentDirectory(): " + chooser2.getCurrentDirectory());
            strDestinationPath=chooser2.getSelectedFile().toString();
            System.out.println("getSelectedFile() : " + chooser2.getSelectedFile());
            System.out.println("Reached till here - 1");
        } else {
            System.out.println("No Selection ");
        }
        System.out.println("Reached till here - 2");
        File directory = new File(strSourcePath);
        File[] myarray;
        //myarray=new File[10];
        myarray=directory.listFiles();
        System.out.println("the file size is : " + myarray.length);
        for (int j = 0; j < myarray.length; j++)
        {
            delete_the_files_in_imp_path(System.getProperty("user.home") +"\\Documents\\Imp_Files\\Current_File\\");
            File path=myarray[j];
            String arrFileName[]=myarray[j].toString().split("\\\\");
            String strFileName=arrFileName[arrFileName.length-1];
            FileReader fr = new FileReader(path);
            String arrDestination_File[]=strFileName.split(".PDF");
            String FinalDestination_FileName=arrDestination_File[0] + ".pdf";
            File f = new File(strDestinationPath + "\\" + FinalDestination_FileName);
            if(f.exists() && !f.isDirectory()) {
                System.out.println(strFileName + " file exists");
                try (FileWriter writer1 = new FileWriter(System.getProperty("user.home") +"\\Documents\\Imp_Files\\Current_File\\CurrentFile.txt",true);
                    BufferedWriter bw1 = new BufferedWriter(writer1)) {
                    bw1.write(strFileName);
                    bw1.newLine();
                } catch (IOException e) {
                    System.err.format("IOException: %s%n", e);
                }
                obj.compare_the_pdfs(strSourcePath,strDestinationPath,strFileName);
                System.out.println("hi");
            }
            else{
                System.out.println(strFileName + " file does not exists");
                try (FileWriter writer = new FileWriter(System.getProperty("user.home") +"\\Documents\\Imp_Files\\Missing_File\\Missing_Files.txt",true);
                     BufferedWriter bw = new BufferedWriter(writer)) {
                    bw.write(strFileName + " file is not present in the destination folder");
                    bw.newLine();
                    bw.close();
                    writer.close();
                } catch (IOException e) {
                    System.err.format("IOException: %s%n", e);
                }
            }


        }
    }

    public static void delete_the_files_in_imp_path(String strPath){
        File directory = new File(strPath);
        // Get all files in directory
        File[] files = directory.listFiles();
        for (File file : files)
        {
            // Delete each file
            if (!file.delete())
            {
                System.out.println("Failed to delete "+file);
            }
        }
    }
}


